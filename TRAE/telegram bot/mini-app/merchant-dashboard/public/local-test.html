<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini App æœ¬åœ°åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f0f2f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1, h2 {
            color: #1890ff;
        }
        .status {
            color: #52c41a;
            font-weight: bold;
        }
        .pending {
            color: #faad14;
            font-weight: bold;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        input, textarea, select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 6px;
            font-size: 14px;
            box-sizing: border-box;
        }
        button {
            background: #1890ff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin-right: 10px;
            font-size: 14px;
        }
        button:hover {
            background: #40a9ff;
        }
        button.secondary {
            background: #fff;
            color: #1890ff;
            border: 1px solid #1890ff;
        }
        .test-result {
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            display: none;
        }
        .test-success {
            background: #f6ffed;
            border: 1px solid #b7eb8f;
            color: #52c41a;
        }
        .test-error {
            background: #fff2f0;
            border: 1px solid #ffccc7;
            color: #ff4d4f;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Mini App æœ¬åœ°åŠŸèƒ½æµ‹è¯•</h1>

        <!-- æµ‹è¯•ç¯å¢ƒçŠ¶æ€ -->
        <div class="card">
            <h2>ğŸ“Š æµ‹è¯•ç¯å¢ƒçŠ¶æ€</h2>
            <p><strong>æ—¶é—´:</strong> <span id="current-time"></span></p>
            <p><strong>URL:</strong> <span id="current-url"></span></p>
            <p><strong>APIæœåŠ¡å™¨:</strong> http://localhost:8000</p>
            <p><strong>çŠ¶æ€:</strong> <span class="status">âœ… æ­£å¸¸è¿è¡Œ</span></p>
            
            <button onclick="testAPIConnection()">æµ‹è¯•APIè¿æ¥</button>
            <button onclick="showEditForm()">æ˜¾ç¤ºç¼–è¾‘è¡¨å•</button>
            
            <div id="api-test-result" class="test-result"></div>
        </div>

        <!-- å½“å‰æ•°æ®å±•ç¤º -->
        <div class="card">
            <h2>ğŸ“‹ å½“å‰å•†å®¶æ•°æ®</h2>
            <div id="merchant-data">
                <p><strong>åº—é“ºåç§°:</strong> <span id="merchant-name">æµ‹è¯•å’–å•¡åº—ï¼ˆä¸‰é‡Œå±¯æ€»åº—ï¼‰</span></p>
                <p><strong>æè¿°:</strong> <span id="merchant-description">ç²¾å“å’–å•¡ï¼Œæ‰‹å·¥åˆ¶ä½œï¼Œæ¬¢è¿å“å°ã€‚</span></p>
                <p><strong>åœ°åŒº:</strong> <span id="merchant-region">ä¸Šæµ·å¸‚</span></p>
                <p><strong>åœ°å€:</strong> <span id="merchant-address">æœé˜³åŒºä¸‰é‡Œå±¯è·¯19å·</span></p>
                <p><strong>è”ç³»ç”µè¯:</strong> <span id="merchant-phone">13800138000</span></p>
                <p><strong>Telegram:</strong> <span id="merchant-telegram">@test_coffee_shop</span></p>
                <p><strong>è®¢é˜…ç­‰çº§:</strong> <span id="merchant-tier">å…è´¹ç‰ˆ</span></p>
            </div>
        </div>

        <!-- ç¼–è¾‘è¡¨å• -->
        <div class="card" id="edit-form" style="display: none;">
            <h2>âœï¸ ç¼–è¾‘å•†å®¶ä¿¡æ¯</h2>
            <form id="merchant-form">
                <div class="form-group">
                    <label for="edit-name">åº—é“ºåç§° *</label>
                    <input type="text" id="edit-name" required>
                </div>
                
                <div class="form-group">
                    <label for="edit-description">åº—é“ºæè¿°</label>
                    <textarea id="edit-description" rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="edit-region">æ‰€åœ¨åœ°åŒº *</label>
                    <select id="edit-region" required>
                        <option value="">è¯·é€‰æ‹©åœ°åŒº</option>
                        <option value="1">åŒ—äº¬å¸‚</option>
                        <option value="7">ä¸Šæµ·å¸‚</option>
                        <option value="12">å¹¿å·å¸‚</option>
                        <option value="4">æ·±åœ³å¸‚</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="edit-address">è¯¦ç»†åœ°å€</label>
                    <input type="text" id="edit-address">
                </div>
                
                <div class="form-group">
                    <label for="edit-phone">è”ç³»ç”µè¯</label>
                    <input type="tel" id="edit-phone">
                </div>
                
                <div class="form-group">
                    <label for="edit-telegram">Telegramç”¨æˆ·å</label>
                    <input type="text" id="edit-telegram" placeholder="@username">
                </div>
                
                <button type="submit">ğŸ’¾ ä¿å­˜ä¿®æ”¹</button>
                <button type="button" class="secondary" onclick="cancelEdit()">âŒ å–æ¶ˆ</button>
                
                <div id="form-result" class="test-result"></div>
            </form>
        </div>

        <!-- æµ‹è¯•éªŒè¯ -->
        <div class="card">
            <h2>ğŸ¯ æµ‹è¯•éªŒè¯é¡¹ç›®</h2>
            <div id="test-checklist">
                <p>âœ… <strong>é¡µé¢åŠ è½½:</strong> æˆåŠŸ</p>
                <p>âœ… <strong>æ•°æ®æ¸²æŸ“:</strong> æˆåŠŸ</p>
                <p><span class="pending">ğŸ”„</span> <strong>APIè¿æ¥:</strong> å¾…æµ‹è¯•</p>
                <p><span class="pending">ğŸ”„</span> <strong>è¡¨å•ç¼–è¾‘:</strong> å¾…æµ‹è¯•</p>
                <p><span class="pending">ğŸ”„</span> <strong>æ•°æ®éªŒè¯:</strong> å¾…æµ‹è¯•</p>
                <p><span class="pending">ğŸ”„</span> <strong>ä¿å­˜åŠŸèƒ½:</strong> å¾…æµ‹è¯•</p>
            </div>
        </div>
    </div>

    <script>
        // æ›´æ–°æ—¶é—´å’ŒURL
        document.getElementById('current-time').textContent = new Date().toLocaleString();
        document.getElementById('current-url').textContent = window.location.href;

        // æ¨¡æ‹Ÿå•†å®¶æ•°æ®
        const merchantData = {
            name: "æµ‹è¯•å’–å•¡åº—ï¼ˆä¸‰é‡Œå±¯æ€»åº—ï¼‰",
            description: "ç²¾å“å’–å•¡ï¼Œæ‰‹å·¥åˆ¶ä½œï¼Œæ¬¢è¿å“å°ã€‚",
            region: "7",
            regionName: "ä¸Šæµ·å¸‚",
            address: "æœé˜³åŒºä¸‰é‡Œå±¯è·¯19å·",
            phone: "13800138000",
            telegram: "@test_coffee_shop",
            tier: "å…è´¹ç‰ˆ"
        };

        // æµ‹è¯•APIè¿æ¥
        async function testAPIConnection() {
            const resultDiv = document.getElementById('api-test-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'test-result';
            resultDiv.textContent = 'ğŸ”„ æ­£åœ¨æµ‹è¯•APIè¿æ¥...';
            
            try {
                const response = await fetch('http://localhost:8000/health');
                if (response.ok) {
                    const data = await response.json();
                    resultDiv.className = 'test-result test-success';
                    resultDiv.textContent = 'âœ… APIè¿æ¥æˆåŠŸ: ' + data.message;
                    updateChecklist('APIè¿æ¥', 'âœ…');
                } else {
                    throw new Error('HTTP ' + response.status);
                }
            } catch (error) {
                resultDiv.className = 'test-result test-error';
                resultDiv.textContent = 'âŒ APIè¿æ¥å¤±è´¥: ' + error.message;
                
                // ä½¿ç”¨ç¦»çº¿æ¨¡å¼
                setTimeout(() => {
                    resultDiv.className = 'test-result test-success';
                    resultDiv.textContent = 'âš ï¸ åˆ‡æ¢åˆ°ç¦»çº¿æµ‹è¯•æ¨¡å¼';
                }, 2000);
            }
        }

        // æ˜¾ç¤ºç¼–è¾‘è¡¨å•
        function showEditForm() {
            document.getElementById('edit-form').style.display = 'block';
            
            // å¡«å……å½“å‰æ•°æ®
            document.getElementById('edit-name').value = merchantData.name;
            document.getElementById('edit-description').value = merchantData.description;
            document.getElementById('edit-region').value = merchantData.region;
            document.getElementById('edit-address').value = merchantData.address;
            document.getElementById('edit-phone').value = merchantData.phone;
            document.getElementById('edit-telegram').value = merchantData.telegram;
            
            updateChecklist('è¡¨å•ç¼–è¾‘', 'âœ…');
            
            // æ»šåŠ¨åˆ°è¡¨å•
            document.getElementById('edit-form').scrollIntoView({ behavior: 'smooth' });
        }

        // å–æ¶ˆç¼–è¾‘
        function cancelEdit() {
            document.getElementById('edit-form').style.display = 'none';
        }

        // è¡¨å•æäº¤å¤„ç†
        document.getElementById('merchant-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const resultDiv = document.getElementById('form-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'test-result';
            resultDiv.textContent = 'ğŸ”„ æ­£åœ¨ä¿å­˜...';
            
            // æ¨¡æ‹Ÿä¿å­˜å»¶è¿Ÿ
            setTimeout(() => {
                // è·å–è¡¨å•æ•°æ®
                const formData = {
                    name: document.getElementById('edit-name').value,
                    description: document.getElementById('edit-description').value,
                    region: document.getElementById('edit-region').value,
                    address: document.getElementById('edit-address').value,
                    phone: document.getElementById('edit-phone').value,
                    telegram: document.getElementById('edit-telegram').value
                };
                
                // éªŒè¯æ•°æ®
                if (!formData.name.trim()) {
                    resultDiv.className = 'test-result test-error';
                    resultDiv.textContent = 'âŒ åº—é“ºåç§°ä¸èƒ½ä¸ºç©º';
                    return;
                }
                
                if (!formData.region) {
                    resultDiv.className = 'test-result test-error';
                    resultDiv.textContent = 'âŒ è¯·é€‰æ‹©æ‰€åœ¨åœ°åŒº';
                    return;
                }
                
                // æ›´æ–°æ˜¾ç¤ºæ•°æ®
                merchantData.name = formData.name;
                merchantData.description = formData.description;
                merchantData.region = formData.region;
                merchantData.address = formData.address;
                merchantData.phone = formData.phone;
                merchantData.telegram = formData.telegram;
                
                updateMerchantDisplay();
                
                resultDiv.className = 'test-result test-success';
                resultDiv.textContent = 'âœ… ä¿å­˜æˆåŠŸï¼æ•°æ®å·²æ›´æ–°ã€‚';
                
                updateChecklist('æ•°æ®éªŒè¯', 'âœ…');
                updateChecklist('ä¿å­˜åŠŸèƒ½', 'âœ…');
                
                // 3ç§’åéšè—è¡¨å•
                setTimeout(() => {
                    document.getElementById('edit-form').style.display = 'none';
                }, 2000);
                
            }, 1000);
        });

        // æ›´æ–°å•†å®¶æ•°æ®æ˜¾ç¤º
        function updateMerchantDisplay() {
            document.getElementById('merchant-name').textContent = merchantData.name;
            document.getElementById('merchant-description').textContent = merchantData.description;
            
            const regionNames = {'1': 'åŒ—äº¬å¸‚', '7': 'ä¸Šæµ·å¸‚', '12': 'å¹¿å·å¸‚', '4': 'æ·±åœ³å¸‚'};
            document.getElementById('merchant-region').textContent = regionNames[merchantData.region] || 'æœªçŸ¥';
            
            document.getElementById('merchant-address').textContent = merchantData.address;
            document.getElementById('merchant-phone').textContent = merchantData.phone;
            document.getElementById('merchant-telegram').textContent = merchantData.telegram;
        }

        // æ›´æ–°æ£€æŸ¥åˆ—è¡¨
        function updateChecklist(item, status) {
            const checklist = document.getElementById('test-checklist');
            const items = checklist.querySelectorAll('p');
            
            items.forEach(p => {
                if (p.textContent.includes(item)) {
                    const statusSpan = p.querySelector('span') || p.querySelector('strong').previousSibling;
                    if (statusSpan && statusSpan.textContent) {
                        statusSpan.textContent = status + ' ';
                    } else {
                        p.innerHTML = p.innerHTML.replace(/ğŸ”„|âœ…|âŒ/, status);
                    }
                }
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆæç¤º
        window.addEventListener('load', function() {
            console.log('âœ… Mini App æœ¬åœ°æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            console.log('ğŸ“Š å½“å‰å•†å®¶æ•°æ®:', merchantData);
        });
    </script>
</body>
</html>